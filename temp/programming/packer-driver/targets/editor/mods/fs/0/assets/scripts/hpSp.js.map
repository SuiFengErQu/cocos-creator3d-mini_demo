{"version":3,"sources":["file:///D:/CocosProject/testDemo/cocos3d20211013/20211014/demolist2/assets/scripts/hpSp.ts"],"names":["_decorator","Component","Node","Vec3","CameraComponent","geometry","systemEvent","SystemEvent","PhysicsSystem","ParticleSystem","ccclass","property","HpSp","start","ray","Ray","on","EventType","TOUCH_END","touchEnd","e","ca","camerr","getComponent","screenPointToRay","getLocationX","getLocationY","instance","raycast","arr","raycastResults","i","length","collider","node","name","console","log","par","play","worldPosition","hitPoint","update","deltaTime","ve","uiHp","parent","getWorldPosition","convertToUINode","hp3dNode","setPosition","dis","distance","scale"],"mappings":"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","sourcesContent":["\nimport { _decorator, Component, Node, Vec3, CameraComponent, geometry, systemEvent, SystemEvent, PhysicsSystem, ParticleSystem } from 'cc';\nconst { ccclass, property } = _decorator;\n\n/**\n * Predefined variables\n * Name = HpSp\n * DateTime = Fri Oct 29 2021 16:10:01 GMT+0800 (中国标准时间)\n * Author = fywxk\n * FileBasename = hpSp.ts\n * FileBasenameNoExtension = hpSp\n * URL = db://assets/scripts/hpSp.ts\n * ManualUrl = https://docs.cocos.com/creator/3.3/manual/zh/\n *\n */\n \n@ccclass('HpSp')\nexport class HpSp extends Component {\n    // [1]\n    // dummy = '';\n\n    // [2]\n    // @property\n    // serializableDummy = 0;\n\n    @property(Node)\n    uiHp:Node = null; // UI\n\n    @property(Node)\n    hp3dNode:Node = null; // 3d 血条挂点\n\n    @property(Node)\n    camerr:Node = null;\n\n    @property(ParticleSystem)\n    par:ParticleSystem = null;\n\n    ray:geometry.Ray = null;\n    start () {\n        // [3]\n        this.ray = new geometry.Ray();\n\n        systemEvent.on(SystemEvent.EventType.TOUCH_END,this.touchEnd,this)\n    }\n    touchEnd(e)\n    {\n        // 射线检测碰撞\n        let ca = this.camerr.getComponent(CameraComponent);\n        ca.screenPointToRay(e.getLocationX(),e.getLocationY(),this.ray);\n        if(PhysicsSystem.instance.raycast(this.ray))\n        {\n            let arr = PhysicsSystem.instance.raycastResults;\n            for(let i=0;i<arr.length;i++)\n            {\n                if(arr[i].collider.node.name==\"Terrain\")\n                {\n                    console.log(\"碰撞到地面\");\n                    this.par.play();\n                    this.par.node.worldPosition = arr[i].hitPoint;\n                    this.node.worldPosition = arr[i].hitPoint;\n                }\n            }\n        }\n    }\n    update (deltaTime: number) {\n        // 血条跟随\n      let ve = new Vec3(0,0,0)\n      this.uiHp.parent.getWorldPosition(ve);\n      let ca = this.camerr.getComponent(CameraComponent);\n      ca.convertToUINode(this.hp3dNode.worldPosition,this.uiHp.parent,ve);\n      this.uiHp.setPosition(ve)\n        // 血条近大远小的效果\n      let dis  = Vec3.distance(this.node.worldPosition,this.camerr.worldPosition);\n      if(dis>10)\n      {\n          this.uiHp.scale = new Vec3(0.02*(100/(dis-10)),0.02*(100/(dis-10)),1)\n      }\n    }\n}\n\n/**\n * [1] Class member could be defined like this.\n * [2] Use `property` decorator if your want the member to be serializable.\n * [3] Your initialization goes here.\n * [4] Your update function goes here.\n *\n * Learn more about scripting: https://docs.cocos.com/creator/3.3/manual/zh/scripting/\n * Learn more about CCClass: https://docs.cocos.com/creator/3.3/manual/zh/scripting/ccclass.html\n * Learn more about life-cycle callbacks: https://docs.cocos.com/creator/3.3/manual/zh/scripting/life-cycle-callbacks.html\n */\n"]}